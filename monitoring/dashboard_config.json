{
  "displayName": "Xynergy Platform - Phase 3 Monitoring",
  "mosaicLayout": {
    "columns": 12,
    "tiles": [
      {
        "width": 6,
        "height": 4,
        "widget": {
          "title": "Cloud Run - Request Rate",
          "xyChart": {
            "dataSets": [{
              "timeSeriesQuery": {
                "timeSeriesFilter": {
                  "filter": "resource.type=\"cloud_run_revision\" AND metric.type=\"run.googleapis.com/request_count\"",
                  "aggregation": {
                    "alignmentPeriod": "60s",
                    "perSeriesAligner": "ALIGN_RATE",
                    "crossSeriesReducer": "REDUCE_SUM",
                    "groupByFields": ["resource.service_name"]
                  }
                }
              },
              "plotType": "LINE"
            }],
            "yAxis": {
              "label": "Requests/Second",
              "scale": "LINEAR"
            }
          }
        }
      },
      {
        "xPos": 6,
        "width": 6,
        "height": 4,
        "widget": {
          "title": "Cloud Run - Memory Utilization",
          "xyChart": {
            "dataSets": [{
              "timeSeriesQuery": {
                "timeSeriesFilter": {
                  "filter": "resource.type=\"cloud_run_revision\" AND metric.type=\"run.googleapis.com/container/memory/utilizations\"",
                  "aggregation": {
                    "alignmentPeriod": "60s",
                    "perSeriesAligner": "ALIGN_MEAN",
                    "crossSeriesReducer": "REDUCE_MEAN",
                    "groupByFields": ["resource.service_name"]
                  }
                }
              },
              "plotType": "LINE"
            }],
            "yAxis": {
              "label": "Memory %",
              "scale": "LINEAR"
            },
            "thresholds": [{
              "value": 0.8,
              "color": "YELLOW",
              "direction": "ABOVE"
            }, {
              "value": 0.9,
              "color": "RED",
              "direction": "ABOVE"
            }]
          }
        }
      },
      {
        "yPos": 4,
        "width": 6,
        "height": 4,
        "widget": {
          "title": "Cloud Run - CPU Utilization",
          "xyChart": {
            "dataSets": [{
              "timeSeriesQuery": {
                "timeSeriesFilter": {
                  "filter": "resource.type=\"cloud_run_revision\" AND metric.type=\"run.googleapis.com/container/cpu/utilizations\"",
                  "aggregation": {
                    "alignmentPeriod": "60s",
                    "perSeriesAligner": "ALIGN_MEAN",
                    "crossSeriesReducer": "REDUCE_MEAN",
                    "groupByFields": ["resource.service_name"]
                  }
                }
              },
              "plotType": "LINE"
            }],
            "yAxis": {
              "label": "CPU %",
              "scale": "LINEAR"
            },
            "thresholds": [{
              "value": 0.7,
              "color": "YELLOW",
              "direction": "ABOVE"
            }, {
              "value": 0.85,
              "color": "RED",
              "direction": "ABOVE"
            }]
          }
        }
      },
      {
        "xPos": 6,
        "yPos": 4,
        "width": 6,
        "height": 4,
        "widget": {
          "title": "Error Rate (5xx) by Service",
          "xyChart": {
            "dataSets": [{
              "timeSeriesQuery": {
                "timeSeriesFilter": {
                  "filter": "resource.type=\"cloud_run_revision\" AND metric.type=\"run.googleapis.com/request_count\" AND metric.label.response_code_class=\"5xx\"",
                  "aggregation": {
                    "alignmentPeriod": "60s",
                    "perSeriesAligner": "ALIGN_RATE",
                    "crossSeriesReducer": "REDUCE_SUM",
                    "groupByFields": ["resource.service_name"]
                  }
                }
              },
              "plotType": "LINE"
            }],
            "yAxis": {
              "label": "Errors/Second",
              "scale": "LINEAR"
            }
          }
        }
      },
      {
        "yPos": 8,
        "width": 4,
        "height": 4,
        "widget": {
          "title": "Active Instance Count",
          "xyChart": {
            "dataSets": [{
              "timeSeriesQuery": {
                "timeSeriesFilter": {
                  "filter": "resource.type=\"cloud_run_revision\" AND metric.type=\"run.googleapis.com/container/instance_count\"",
                  "aggregation": {
                    "alignmentPeriod": "60s",
                    "perSeriesAligner": "ALIGN_MEAN",
                    "crossSeriesReducer": "REDUCE_SUM",
                    "groupByFields": ["resource.service_name"]
                  }
                }
              },
              "plotType": "STACKED_AREA"
            }],
            "yAxis": {
              "label": "Instances",
              "scale": "LINEAR"
            }
          }
        }
      },
      {
        "xPos": 4,
        "yPos": 8,
        "width": 4,
        "height": 4,
        "widget": {
          "title": "Request Latency (P95)",
          "xyChart": {
            "dataSets": [{
              "timeSeriesQuery": {
                "timeSeriesFilter": {
                  "filter": "resource.type=\"cloud_run_revision\" AND metric.type=\"run.googleapis.com/request_latencies\"",
                  "aggregation": {
                    "alignmentPeriod": "60s",
                    "perSeriesAligner": "ALIGN_DELTA",
                    "crossSeriesReducer": "REDUCE_PERCENTILE_95",
                    "groupByFields": ["resource.service_name"]
                  }
                }
              },
              "plotType": "LINE"
            }],
            "yAxis": {
              "label": "Latency (ms)",
              "scale": "LINEAR"
            },
            "thresholds": [{
              "value": 1000,
              "color": "YELLOW",
              "direction": "ABOVE"
            }, {
              "value": 3000,
              "color": "RED",
              "direction": "ABOVE"
            }]
          }
        }
      },
      {
        "xPos": 8,
        "yPos": 8,
        "width": 4,
        "height": 4,
        "widget": {
          "title": "Billing Costs (Estimated)",
          "xyChart": {
            "dataSets": [{
              "timeSeriesQuery": {
                "timeSeriesFilter": {
                  "filter": "resource.type=\"cloud_run_revision\" AND metric.type=\"run.googleapis.com/container/billable_instance_time\"",
                  "aggregation": {
                    "alignmentPeriod": "3600s",
                    "perSeriesAligner": "ALIGN_RATE",
                    "crossSeriesReducer": "REDUCE_SUM",
                    "groupByFields": ["resource.service_name"]
                  }
                }
              },
              "plotType": "STACKED_AREA"
            }],
            "yAxis": {
              "label": "Billable Time (hours)",
              "scale": "LINEAR"
            }
          }
        }
      }
    ]
  }
}
